<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ AREC –Ω–∞ Raspberry Pi</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 900px; margin: 2rem auto; padding: 0 1rem; color: #333; }
    h1, h2, h3 { color: #2c3e50; }
    pre, code { background: #f4f4f4; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.95em; }
    pre { padding: 1rem; overflow-x: auto; border-left: 4px solid #3498db; }
    .note { background: #fff8e1; padding: 1rem; border-radius: 6px; margin: 1.5rem 0; border-left: 4px solid #ffc107; }
    .success { background: #e8f5e9; border-left: 4px solid #4caf50; }
    ul, ol { padding-left: 1.5rem; }
  </style>
</head>
<body>

<h1>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ <code>arec_p.py</code> –Ω–∞ Raspberry Pi</h1>

<p>–≠—Ç–æ –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –°–∫—Ä–∏–ø—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–≤—É–∫, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –µ–≥–æ –≤ –æ–±–ª–∞–∫–æ –∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å.</p>

<h2>üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç?</h2>
<ul>
  <li>–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–≤—É–∫ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö).</li>
  <li>–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Opus (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), AAC –∏–ª–∏ MP3.</li>
  <li>–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ <strong>–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫</strong> –∏–ª–∏ <strong>Google Drive</strong>.</li>
  <li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç <strong>—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ —Å 9:00 –¥–æ 18:00).</li>
  <li>–¢—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –∑–≤—É–∫ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å ‚Äî —Å–ª—É—à–∞—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.</li>
   <li>–°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ä–∞–±–æ—Ç—É —Å USB-–º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º Boya BY-LM40.</li>
</ul>

<h2>üîß –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É</h2>
<pre><code>sudo apt update && sudo apt upgrade -y</code></pre>

<h2>üîß –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</h2>
<pre><code>sudo apt install -y python3 python3-pip python3-schedule alsa-utils ffmpeg rclone ntpdate icecast2 nginx-light</code></pre>

<blockquote class="note">
  <strong>–í–∞–∂–Ω–æ!</strong> –ü–∞–∫–µ—Ç <code>python3-schedule</code> –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è. –ë–µ–∑ –Ω–µ–≥–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.
</blockquote>

<p>–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ <code>icecast2</code> –ø–æ—è–≤–∏—Ç—Å—è –æ–∫–Ω–æ ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ <strong>¬´–î–∞¬ª</strong> –∏ –∑–∞–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥–µ—Ç <code>hackme</code>). –ü–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –∫–æ–≥–¥–∞ –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç.</p>

<h2>üîß –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω</h2>
<pre><code>arecord -l</code></pre>
<p>–ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–µ –ø—É—Å—Ç–æ–π ‚Äî –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç.</p>

<h2>üîß –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Icecast2</h2>
<pre><code>sudo nano /etc/icecast2/icecast.xml</code></pre>
<p>–ù–∞–π–¥–∏—Ç–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å:</p>
<pre><code><source-password>password: hackme</source-password>
<bind-address>ip-adress: 0.0.0.0</bind-address>
<port>port: 8000</port></code></pre>
<p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (<kbd>Ctrl+O</kbd> ‚Üí <kbd>Enter</kbd>) –∏ –≤—ã–π–¥–∏—Ç–µ (<kbd>Ctrl+X</kbd>).</p>
<p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Icecast:</p>
<pre><code>sudo systemctl enable --now icecast2</code></pre>

<h2>üîß –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±–ª–∞–∫–æ (–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ –∏–ª–∏ Google Drive)</h2>
<pre><code>rclone config</code></pre>
<p>–°–ª–µ–¥—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ò–º—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:</p>
<ul>
  <li><code>yandex.disk</code> ‚Äî –¥–ª—è –Ø–Ω–¥–µ–∫—Å–∞,</li>
  <li><code>google.drive</code> ‚Äî –¥–ª—è Google.</li>
</ul>

<h2>üîß –®–∞–≥ 6: –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –∏ —Å–∫—Ä–∏–ø—Ç</h2>
<pre><code>sudo mkdir -p /opt/arec_p
sudo nano /opt/arec_p/arec_p.py</code></pre>
<p>–í—Å—Ç–∞–≤—å—Ç–µ <strong>–ø–æ–ª–Ω—ã–π –∫–æ–¥ Python-—Å–∫—Ä–∏–ø—Ç–∞.</strong> –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∑–∞–∫—Ä–æ–π—Ç–µ.</p>
<p>–°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:</p>
<pre><code>sudo chmod +x /opt/arec_p/arec_p.py</code></pre>

<h2>üîß –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
<p>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:</p>
<pre><code>sudo nano /opt/arec_/arec_p.py</code></pre>
<p>–ò–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:</p>
<ul>
  <li><code>CLOUD_SERVICE = "yandex"</code> ‚Üí <code>"google"</code> –∏–ª–∏ <code>"none"</code></li>
  <li><code>ICECAST_PASSWORD = "hackme"</code> ‚Üí –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –ø–∞—Ä–æ–ª–µ–º –∏–∑ –®–∞–≥–∞ 4</li>
  <li><code>RECORDING_SCHEDULE_ENABLED = True</code> ‚Äî —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</li>
  <li>–í—Ä–µ–º—è: <code>RECORDING_START_HOUR = 9</code>, <code>RECORDING_END_HOUR = 18</code></li>
</ul>

<h2>üîß –®–∞–≥ 8: –°–æ–∑–¥–∞–π—Ç–µ systemd-—Å–µ—Ä–≤–∏—Å</h2>
<pre><code>sudo nano /etc/systemd/system/arec_p.service</code></pre>
<p>–í—Å—Ç–∞–≤—å—Ç–µ:</p>
<pre><code>[Unit]
Description=AREC Audio Recorder
After=network.target icecast2.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/arec_p
ExecStart=/usr/bin/python3 /opt/arec_p/arec_p.py
Restart=on-failure
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target</code></pre>

<h2>üîß –®–∞–≥ 9: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç</h2>
<pre><code>sudo systemctl daemon-reload
sudo systemctl enable --now arec_p.service</code></pre>
<p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:</p>
<pre><code>sudo systemctl status arec_p</code></pre>

<h2>üîß –®–∞–≥ 10: –°–æ–∑–¥–∞–π—Ç–µ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å—Ç—Ä–∏–º–∞</h2>
<pre><code>sudo nano /var/www/html/stream.html</code></pre>
<p>–í—Å—Ç–∞–≤—å—Ç–µ (–∑–∞–º–µ–Ω–∏—Ç–µ <code>–í–ê–®_IP</code> –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π IP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —É–∑–Ω–∞—Ç—å: <code>hostname -I</code>):</p>
<xmp><!DOCTYPE html>
<html>
<head><title>Live Audio</title></head>
<body>
 <h1>üéß –ü—Ä—è–º–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∑–≤—É–∫–∞</h1>
  <audio controls autoplay>
    <source src="http://–í–ê–®_IP:8000/live.mp3" type="audio/mpeg">
  </audio>
</body>
</html></xmp>

<p>–¢–µ–ø–µ—Ä—å:</p>
<ul>
  <li>–§–∞–π–ª—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ <code>/opt/arec_p/</code>,</li>
  <li>–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–æ,</li>
  <li>–°—Ç—Ä–∏–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: <code>http://–í–ê–®_IP/stream.html</code></li>
</ul>

<div class="success">
  <p><strong>–°–æ–≤–µ—Ç:</strong> –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:</p>
  <pre><code>sudo journalctl -u arec_p -f</code></pre>
</div>

</body>
</html>